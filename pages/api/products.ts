import Kachecker from "@juliano.ladeira/kachecker"
import { NowRequest, NowResponse } from '@now/node'

const kachecker = new Kachecker();
kachecker.registerAll();

export default async (req: NowRequest, res: NowResponse) => {

    // if (process.env.NODE_ENV === "development") {
    if (process.env.NODE_ENV === "test") {
        res.status(200).send(sampleProducts)
    } else {
        const productsResponse = await kachecker.fetchProducts();
        const cacheControl = productsResponse.length > 0 ? 's-maxage=600, stale-while-revalidate' : 'no-cache';

        res.setHeader('Cache-Control', cacheControl)
        res.status(200).send(productsResponse)
    }

}

const sampleProducts = [{ "fabricante": 564, "produto": "Headset Gamer Razer Electra V2 7.1 Virtual - USB - RZ04-02220100-R3U1", "oferta_codigo": 95954, "ordem_listagem": 2, "quantidade": 11, "dep_nome": "Periféricos", "data_acab": 0, "sec_nome": "Headset Gamer", "dep": "03", "vlr_normal": "599.88", "sec_amigavel": "headset-gamer", "tmp_avaliacao_numero": 13, "tmp_ranking": 51, "sec": "12051", "data_ini": 1587516300, "tmp_avaliacao_nota": 5, "destaque_listagem": true, "codigo": 94248, "imagem": "https://images8.kabum.com.br/produtos/fotos/94248/94248_1515182853_index_m.jpg", "dep_amigavel": "perifericos", "desconto": 21, "oferta_quantidade_vendida": 19, "data_fim": 1588244400, "vlr_oferta": 399.8995 }, { "fabricante": 1468, "produto": "Teclado Mecânico Gamer Redragon Kumara, LED Vermelho, Switch Outemu Blue, PT - K552", "oferta_codigo": 93451, "ordem_listagem": 3, "quantidade": 405, "dep_nome": "Periféricos", "data_acab": 0, "sec_nome": "Teclado Gamer", "dep": "03", "vlr_normal": "270.47", "sec_amigavel": "teclado-gamer", "tmp_avaliacao_numero": 390, "tmp_ranking": 62, "sec": "12111", "data_ini": 1587384000, "tmp_avaliacao_nota": 5, "destaque_listagem": true, "codigo": 89171, "imagem": "https://images1.kabum.com.br/produtos/fotos/89171/89171_2_1523620293_m.jpg", "dep_amigavel": "perifericos", "desconto": 13, "oferta_quantidade_vendida": 595, "data_fim": 1588244400, "vlr_oferta": 199.903 }, { "fabricante": 2439, "produto": "Google Smart Home Mini, Preto - GA00781-BR", "oferta_codigo": 94526, "ordem_listagem": 4, "quantidade": 261, "dep_nome": "Smart Home", "data_acab": 0, "sec_nome": "Assistente Virtual", "dep": "11895", "vlr_normal": "299.90", "sec_amigavel": "assistente-virtual", "tmp_avaliacao_numero": 0, "tmp_ranking": 894, "sec": "11992", "data_ini": 1587416400, "tmp_avaliacao_nota": 0, "destaque_listagem": true, "codigo": 108078, "imagem": "https://images8.kabum.com.br/produtos/fotos/108078/google-smart-home-mini-preto-ga00781-br_google-smart-home-mini-preto-ga00781-br_1573567229_m.jpg", "dep_amigavel": "smart-home", "desconto": 10, "oferta_quantidade_vendida": 69, "data_fim": 1587985200, "vlr_oferta": 248.9982 }, { "fabricante": 7, "produto": "Smartphone LG K12 Max, 32GB, 13MP, Tela 6.26´, Preto - LMX520BMW", "oferta_codigo": 95193, "ordem_listagem": 5, "quantidade": 50, "dep_nome": "Celular & Telefone", "data_acab": 0, "sec_nome": "Smartphones", "dep": "2422", "vlr_normal": "969.89", "sec_amigavel": "smartphones", "tmp_avaliacao_numero": 0, "tmp_ranking": 358, "sec": "2424", "data_ini": 1587121200, "tmp_avaliacao_nota": 0, "destaque_listagem": true, "codigo": 102041, "imagem": "https://images1.kabum.com.br/produtos/fotos/102041/smartphone-lg-k12-max-32gb-13mp-tela-6-26-preto-lmx520bmw_smartphone-lg-k12-max-32gb-13mp-tela-6-26-preto-lmx520bmw_1562248032_m.jpg", "dep_amigavel": "celular-telefone", "desconto": 24, "oferta_quantidade_vendida": 90, "data_fim": 1588276800, "vlr_oferta": 659.898 }, { "fabricante": 33, "produto": "Notebook Acer Aspire 5 A515-52-56A8, Intel Core i5-8265U, 8GB, HD 1TB, SSD 128GB, Windows 10 Home, 15.6´, Prata", "oferta_codigo": 94993, "ordem_listagem": 7, "quantidade": 29, "dep_nome": "Computadores", "data_acab": 0, "sec_nome": "Notebooks / Ultrabooks", "dep": "04", "vlr_normal": "3789.37", "sec_amigavel": "notebooks-ultrabooks", "tmp_avaliacao_numero": 0, "tmp_ranking": 886, "sec": "35", "data_ini": 1587121200, "tmp_avaliacao_nota": 0, "destaque_listagem": true, "codigo": 104054, "imagem": "https://images4.kabum.com.br/produtos/fotos/104054/notebook-acer-aspire-5-a515-52-56a8-intel-core-i5-8265u-8gb-hd-1tb-ssd-128gb-windows-10-home-15-6-prata_notebook-acer-aspire-5-a515-52-56a8-intel-core-i5-8265u-8gb-hd-1tb-ssd-128gb-windows-10-home-15-6-prata_1567780433_m.jpg", "dep_amigavel": "computadores", "desconto": 5, "oferta_quantidade_vendida": 71, "data_fim": 1588276800, "vlr_oferta": 3399.898 }, { "fabricante": 12, "produto": "Tablet Samsung Tab A, Bluetooth, Android 9.0, 32GB, 8MP, Tela 8´, Preto -  SM-T290NZKMZTO", "oferta_codigo": 94981, "ordem_listagem": 9, "quantidade": 15, "dep_nome": "Computadores", "data_acab": 0, "sec_nome": "Tablets", "dep": "04", "vlr_normal": "873.58", "sec_amigavel": "tablets", "tmp_avaliacao_numero": 0, "tmp_ranking": 2082, "sec": "934", "data_ini": 1587121200, "tmp_avaliacao_nota": 0, "destaque_listagem": true, "codigo": 104549, "imagem": "https://images9.kabum.com.br/produtos/fotos/104549/tablet-samsung-tab-a-bluetooth-android-9-0-32gb-8mp-tela-8-preto-sm-t290nzkmzto_tablet-samsung-tab-a-bluetooth-android-9-0-32gb-8mp-tela-8-preto-sm-t290nzkmzto_1569498517_m.jpg", "dep_amigavel": "computadores", "desconto": 9, "oferta_quantidade_vendida": 25, "data_fim": 1588276800, "vlr_oferta": 749.9015 }, { "fabricante": 235, "produto": "Nobreak TS Shara UPS Senoidal 2200 4BS/2BA Universal Bivolt 4420", "oferta_codigo": 95673, "ordem_listagem": 10, "quantidade": 173, "dep_nome": "Periféricos", "data_acab": 0, "sec_nome": "Energia", "dep": "03", "vlr_normal": "1528.12", "sec_amigavel": "energia", "tmp_avaliacao_numero": 6, "tmp_ranking": 781, "sec": "288", "data_ini": 1587122400, "tmp_avaliacao_nota": 5, "destaque_listagem": true, "codigo": 97044, "imagem": "https://images4.kabum.com.br/produtos/fotos/97044/97044_1528912175_index_m.jpg", "dep_amigavel": "perifericos", "desconto": 16, "oferta_quantidade_vendida": 27, "data_fim": 1588276800, "vlr_oferta": 1089.904 }, { "fabricante": 564, "produto": "Headset Razer Kraken X Multi Platform Mercury, P3, Branco - RZ04-02890300-R3U1", "oferta_codigo": 95074, "ordem_listagem": 11, "quantidade": 207, "dep_nome": "Periféricos", "data_acab": 0, "sec_nome": "Headset Gamer", "dep": "03", "vlr_normal": "470.47", "sec_amigavel": "headset-gamer", "tmp_avaliacao_numero": 0, "tmp_ranking": 118, "sec": "12051", "data_ini": 1587121200, "tmp_avaliacao_nota": 0, "destaque_listagem": true, "codigo": 110162, "imagem": "https://images2.kabum.com.br/produtos/fotos/110162/headset-razer-kraken-x-multi-platform-mercury-p3-branco-rz04-02890300-r3u1_1583239402_m.jpg", "dep_amigavel": "perifericos", "desconto": 21, "oferta_quantidade_vendida": 233, "data_fim": 1588276800, "vlr_oferta": 315.9025 }, { "fabricante": 2153, "produto": "Gabinete Gamer Nox Hummer MC Pro, Mid Tower, ARGB, com FAN, Lateral em Acrílico - NXHUMMERMCPROB", "oferta_codigo": 96112, "ordem_listagem": 12, "quantidade": 83, "dep_nome": "Periféricos", "data_acab": 0, "sec_nome": "Gabinetes", "dep": "03", "vlr_normal": "329.29", "sec_amigavel": "gabinetes", "tmp_avaliacao_numero": 0, "tmp_ranking": 637, "sec": "464", "data_ini": 1587552300, "tmp_avaliacao_nota": 0, "destaque_listagem": true, "codigo": 109016, "imagem": "https://images6.kabum.com.br/produtos/fotos/109016/gabinete-gamer-nox-hummer-mc-pro-mid-tower-argb-com-fan-lateral-em-acrilico-nxhummermcprob_1579518889_m.jpg", "dep_amigavel": "perifericos", "desconto": 28, "oferta_quantidade_vendida": 17, "data_fim": 1588244400, "vlr_oferta": 199.903 }]
